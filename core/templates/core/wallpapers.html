{% extends "core/base.html" %}
{% load static %}

{% block content %}
<section class="wallpapers-section">
    <h1>Galeria tapet</h1>
    
    <div class="wallpaper-grid">
        {% if wallpapers %}
        {% for img in wallpapers %}
            <img src="{% static 'img/wallpapers/'|add:img %}"
                 alt=""
                 loading="lazy">
        {% endfor %}
    {% else %}
        <p>Brak tapet ðŸ˜¢</p>
    {% endif %}
    </div>
</section>
<script>
window.addEventListener('load', () => {
    const grid = document.querySelector('.wallpaper-grid');
    const images = Array.from(grid.querySelectorAll('img'));

    function layoutMasonry() {
        const gridWidth = grid.clientWidth;
        const colWidth = 200;
        const gap = 16;

        const cols = Math.max(1, Math.floor((gridWidth + gap) / (colWidth + gap)));
        const colHeights = Array(cols).fill(0);

        // ðŸ”¥ WYÅšRODKOWANIE
        const usedWidth = cols * colWidth + (cols - 1) * gap;
        const offsetX = Math.max(0, (gridWidth - usedWidth) / 2);

        images.forEach(img => {
            const ratio = img.naturalWidth / img.naturalHeight;
            let imgCols = (ratio > 1.5 && cols > 1) ? 2 : 1;

            const width = imgCols * colWidth + (imgCols - 1) * gap;
            const height = width / ratio;

            let minCol = 0;
            let minHeight = Infinity;

            for (let i = 0; i <= cols - imgCols; i++) {
                const h = Math.max(...colHeights.slice(i, i + imgCols));
                if (h < minHeight) {
                    minHeight = h;
                    minCol = i;
                }
            }

            img.style.width = width + 'px';
            img.style.top = minHeight + 'px';
            img.style.left = offsetX + minCol * (colWidth + gap) + 'px';

            const newHeight = minHeight + height + gap;
            for (let i = minCol; i < minCol + imgCols; i++) {
                colHeights[i] = newHeight;
            }
        });

        grid.style.height = Math.max(...colHeights) + 'px';
    }

    layoutMasonry();
    window.addEventListener('resize', layoutMasonry);
});

</script>


{% endblock %}
