{% extends "core/base.html" %}
{% load static %}

{% block content %}
<section class="wallpapers-section">
    <h1>Galeria tapet</h1>
    
    <div class="wallpaper-grid">
        {% if wallpapers %}
        {% for img in wallpapers %}
            <img src="{% static 'img/wallpapers/'|add:img %}"
                 alt=""
                 loading="lazy">
        {% endfor %}
    {% else %}
        <p>Brak tapet ðŸ˜¢</p>
    {% endif %}
    </div>
</section>
<script>
window.addEventListener('load', () => {
    const grid = document.querySelector('.wallpaper-grid');
    const images = Array.from(grid.querySelectorAll('img'));

    function layoutMasonry() {
        const gridWidth = grid.clientWidth;
        const colWidth = 200; // szerokoÅ›Ä‡ jednej kolumny
        const gap = 16;       // odstÄ™p miÄ™dzy obrazkami
        const cols = Math.floor(gridWidth / (colWidth + gap));
        const colHeights = Array(cols).fill(0); // wysokoÅ›Ä‡ kaÅ¼dej kolumny

        images.forEach(img => {
            const ratio = img.naturalWidth / img.naturalHeight;
            let imgCols = 1;

            // szerokie â†’ 2 kolumny
            if (ratio > 1.5 && cols > 1) imgCols = 2;

            // szerokoÅ›Ä‡ obrazka
            const width = imgCols * colWidth + (imgCols - 1) * gap;
            const height = width / ratio;

            // znajdÅº najlepszÄ… kolumnÄ™ do wstawienia
            let minCol = 0;
            let minHeight = Infinity;

            for (let i = 0; i <= cols - imgCols; i++) {
                const maxColHeight = Math.max(...colHeights.slice(i, i + imgCols));
                if (maxColHeight < minHeight) {
                    minHeight = maxColHeight;
                    minCol = i;
                }
            }

            // ustaw pozycjÄ™ obrazka
            img.style.width = width + 'px';
            img.style.top = minHeight + 'px';
            img.style.left = (minCol * (colWidth + gap)) + 'px';

            // zaktualizuj wysokoÅ›ci kolumn
            const newHeight = minHeight + height + gap;
            for (let i = minCol; i < minCol + imgCols; i++) {
                colHeights[i] = newHeight;
            }
        });

        // ustaw wysokoÅ›Ä‡ kontenera, Å¼eby obejmowaÅ‚ wszystkie obrazki
        grid.style.height = Math.max(...colHeights) + 'px';
    }

    // uruchom ukÅ‚ad Masonry
    layoutMasonry();

    // aktualizacja przy resize
    window.addEventListener('resize', layoutMasonry);
});

</script>


{% endblock %}
